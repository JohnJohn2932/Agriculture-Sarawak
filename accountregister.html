<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - GreenGrow Sarawak</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="accountregister.css">
    <script src="script.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <a href="index.html"><img src="assets/logo.png" alt="Logo"></a>
        </div>
        <nav class="nav-container" style="display: flex; justify-content: center;">
            <ul class="nav-links" style="display: flex; gap: 2rem; justify-content: center; align-items: center;">
                <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                <li><a href="weather.html" data-i18n="nav_weather">Weather</a></li>
                <li><a href="plant.html" data-i18n="nav_plant">Plant</a></li>
                <!-- <li><a href="contact.html" data-i18n="nav_contact">Contact</a></li> -->
            </ul>
        </nav>
        <div class="header-auth">
            <a href="accountregister.html" data-i18n="header_register">Register</a>
            <span class="divider">|</span>
            <a href="accountlogin.html" data-i18n="header_login">Login</a>
        </div>
    </header>

    <!-- Registration Section -->
    <main class="registration-container">
        <div class="registration-box">
            <div class="registration-header">
                <h2 data-i18n="accountregister.title">Create Your Account</h2>
                <p data-i18n="accountregister.description">Join GreenGrow Sarawak and start your agricultural journey</p>
            </div>

            <form id="registerForm" method="POST" action="/register">
                <div id="messageBox" class="message-box" style="display: none;"></div>
                <div class="form-group">
                    <label for="fullName" data-i18n="accountregister.username">Username</label>
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="fullName" name="fullName" placeholder="Enter your username" required maxlength="11" pattern="^[^\s]{1,11}$" title="Username must be 1-11 characters, no spaces">
                    </div>
                    <div id="username-error" style="color: #e74c3c; font-size: 0.95em; display: none; margin-top: 0.2em;"></div>
                </div>

                <div class="form-group">
                    <label for="email" data-i18n="accountregister.email">Email Address</label>
                    <div class="input-group">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <div class="input-group">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="address">Delivery Address</label>
                    <div class="input-group">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" id="address" name="address" placeholder="Street Address" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="city">City</label>
                    <div class="input-group">
                        <i class="fas fa-city"></i>
                        <input type="text" id="city" name="city" placeholder="City" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="state">State</label>
                    <div class="input-group">
                        <i class="fas fa-map"></i>
                        <select id="state" name="state" required>
                            <option value="">Select State</option>
                            <option value="Kuching">Kuching</option>
                            <option value="Miri">Miri</option>
                            <option value="Sibu">Sibu</option>
                            <option value="Bintulu">Bintulu</option>
                            <option value="Limbang">Limbang</option>
                            <option value="Sri Aman">Sri Aman</option>
                            <option value="Sarikei">Sarikei</option>
                            <option value="Kapit">Kapit</option>
                            <option value="Mukah">Mukah</option>
                            <option value="Betong">Betong</option>
                            <option value="Samarahan">Samarahan</option>
                            <option value="Serian">Serian</option>
                            <option value="Lubok Antu">Lubok Antu</option>
                            <option value="Lawas">Lawas</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="postcode">Postcode</label>
                    <div class="input-group">
                        <i class="fas fa-mail-bulk"></i>
                        <input type="text" id="postcode" name="postcode" placeholder="Postcode" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password" data-i18n="accountregister.password">Password</label>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" name="password" placeholder="Create a password" required>
                        <i class="fas fa-eye toggle-password"></i>
                    </div>
                    <div class="password-strength">
                        <div class="strength-bar"></div>
                        <span class="strength-text">Password strength</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" required>
                        <i class="fas fa-eye toggle-password"></i>
                    </div>
                </div>

                <div class="form-group terms">
                    <input type="checkbox" id="terms" name="terms" required>
                    <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                </div>

                <button type="submit" class="submit-btn" data-i18n="accountregister.submit">Create Account</button>

                <div class="login-link">
                    Already have an account? <a href="accountlogin.html">Log in</a>
                </div>
            </form>
        </div>

        <div class="registration-image">
            <img src="assets/registration-bg.jpg" alt="Agriculture Background">
            <div class="image-overlay">
                <h3>Join Our Community</h3>
                <p>Connect with farmers, suppliers, and buyers across Sarawak</p>
                <div class="benefits-list">
                    <li><i class="fas fa-check-circle"></i> Access to weather forecasts</li>
                    <li><i class="fas fa-check-circle"></i> Plant information database</li>
                    <li><i class="fas fa-check-circle"></i> Farming tips and guides</li>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3 data-i18n="site_title">GreenGrow Sarawak</h3>
                <p data-i18n="footer_description">Empowering farmers with technology and sustainable solutions.</p>
            </div>
            <div class="footer-section">
                <h3 data-i18n="footer_quick_links_header">Quick Links</h3>
                <ul>
                    <li><a href="index.html" data-i18n="nav_home">Home</a></li>
                    <li><a href="weather.html" data-i18n="nav_weather">Weather</a></li>
                    <li><a href="plant.html" data-i18n="nav_plant">Plant</a></li>
                    <!-- <li><a href="contact.html" data-i18n="nav_contact">Contact</a></li> -->
                </ul>
            </div>
            <div class="footer-section">
                <h3 data-i18n="footer_contact_header">Contact Us</h3>
                <p data-i18n="footer_contact_address"><i class="fas fa-map-marker-alt"></i> Kuching, Sarawak</p>
                <p data-i18n="footer_contact_phone"><i class="fas fa-phone"></i> +60 12-345 6789</p>
                <p data-i18n="footer_contact_email"><i class="fas fa-envelope"></i> info@greengrow.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-i18n="footer_copyright">&copy; 2025 GreenGrow Sarawak. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Password visibility toggle
        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', function() {
                const input = this.previousElementSibling;
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
        });

        // Password strength indicator
        const passwordInput = document.getElementById('password');
        const strengthBar = document.querySelector('.strength-bar');
        const strengthText = document.querySelector('.strength-text');

        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let text = '';

            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;

            switch(strength) {
                case 0:
                    text = 'Very Weak';
                    strengthBar.style.width = '20%';
                    strengthBar.style.backgroundColor = '#e74c3c';
                    break;
                case 1:
                    text = 'Weak';
                    strengthBar.style.width = '40%';
                    strengthBar.style.backgroundColor = '#e67e22';
                    break;
                case 2:
                    text = 'Medium';
                    strengthBar.style.width = '60%';
                    strengthBar.style.backgroundColor = '#f1c40f';
                    break;
                case 3:
                    text = 'Strong';
                    strengthBar.style.width = '80%';
                    strengthBar.style.backgroundColor = '#2ecc71';
                    break;
                case 4:
                case 5:
                    text = 'Very Strong';
                    strengthBar.style.width = '100%';
                    strengthBar.style.backgroundColor = '#27ae60';
                    break;
            }

            strengthText.textContent = text;
        });

        // Form validation and submission
        const form = document.getElementById('registerForm');
        const messageBox = document.getElementById('messageBox');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showMessage('Passwords do not match!', 'error');
                return;
            }

            try {
                const formData = new FormData(form);
                const response = await fetch('/register', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, 'success');
                    setTimeout(() => {
                        window.location.href = 'accountlogin.html';
                    }, 2000);
                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('An error occurred. Please try again.', 'error');
            }
        });

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`;
            messageBox.style.display = 'block';
        }

        // Username input: enforce max 11 characters in real time and show error
        const usernameInput = document.getElementById('fullName');
        const usernameError = document.getElementById('username-error');
        if (usernameInput && usernameError) {
            usernameInput.addEventListener('input', function() {
                if (this.value.length > 11) {
                    this.value = this.value.slice(0, 11);
                }
                if (this.value.length === 11) {
                    usernameError.style.display = 'block';
                    usernameError.textContent = 'Username cannot exceed 11 characters.';
                } else {
                    usernameError.style.display = 'none';
                }
            });
        }
    </script>

    <style>
        .message-box {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            text-align: center;
        }
        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</body>
</html>
